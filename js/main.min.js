(function(e){function p(t,s,o,u,a){if(t){i.text("There was an error starting video, please refresh and try again.");return}n=o;var f=i[0].getBoundingClientRect();var l=f.width;var c=w(u,a,l,l);e(n).css({width:l+c.width+"px",height:l+c.height+"px","margin-left":-Math.floor(c.width/2)+"px","margin-top":-Math.floor(c.height/2)+"px"});r={interval:.15,numFrames:15,gifWidth:l,gifHeight:l,cameraStream:s,keepCameraOn:true,progressCallback:m,text:"faceGIF.com",fontFamily:"Source Sans Pro",fontColor:"rgba(255,255,255,0.8)",textXCoordinate:l-50,textYCoordinate:l-5};e("#actions").show();d()}function d(){i.find("img").remove();i.append(n);n.play();h.set(0);o.hide();s.fadeIn();l.create.one("click",v);e(window).on("keyup",function t(n){if(n.keyCode==32){e(window).off("keyup",t);v()}})}function v(){f.addClass("rotating");h.path.setAttribute("stroke",c);e(h.svg).show();gifshot.createGIF(r,g)}function m(e){if(e===1){h.path.setAttribute("stroke","rgba(44,146,54,0.2)");n.pause();f.removeClass("rotating");a.fadeIn()}h.set(e)}function g(n){if(n.error){i.html("There was an error creating your GIF. Please refresh and try again.");return}a.hide();e(h.svg).hide();var r=n.image;var u=document.createElement("img");u.src=r;i.find("video").remove();i.append(u);t=r;s.hide();o.fadeIn();l.download.attr({href:r,download:"facegif.gif"});l.reset.one("click",d);l.share.off();l.share.on("click",y)}function y(){vex.open({content:'<div class="dialog-title">Share</div>'+'<div class="share-items">'+'<a id="share-imgur" href="javascript:" title="Share on Imgur" style="overflow:hidden; width:100px; height:36px; background:url(img/imgur.png) top left no-repeat transparent;"></a>'+"</div>"});e("#share-imgur").off().on("click",b)}function b(){var n=t.replace(/^data:[^,]+,/,"");a.fadeIn();e.ajax({url:"https://api.imgur.com/3/image",method:"POST",headers:{Authorization:"Client-ID 1dd9c443be8f3fe",Accept:"application/json"},data:{image:n,type:"base64"}}).done(function(t){var n=e(".share-items");a.hide();if(!t.success){n.append("<span>Please try again.</span>");return}var r="https://imgur.com/gallery/"+t.data.id;var i=document.createElement("a");i.setAttribute("href",r);i.setAttribute("title","Your faceGIF on Imgur");i.innerHTML=r;n.append(i)})}function w(e,t,n,r){var i={width:0,height:0,scaledWidth:0,scaledHeight:0};if(e>t){i.width=Math.round(e*(r/t))-n;i.scaledWidth=Math.round(i.width*(t/r))}else{i.height=Math.round(t*(n/e))-r;i.scaledHeight=Math.round(i.height*(e/n))}return i}vex.defaultOptions.className="vex-theme-wireframe";var t;var n;var r;var i=e("#placeholder");var s=e("#stream-actions");var o=e("#gif-actions");var u=e("#action-create");var a=e(".loader");var f=u.find("img");var l={create:u,reset:e("#action-reset"),download:e("#action-download"),share:e("#action-share")};var c="rgba(44,146,54,0.8)";var h=new ProgressBar.Line(".progress-bar",{color:c,strokeWidth:3,duration:1,trailColor:"rgba(221,221,221,0.6)"});if(navigator.getMedia){GumHelper.startVideoStreaming(p)}else{i.text("Your browser does not support video capture.")}})(jQuery)
