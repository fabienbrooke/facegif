!function(d){var r,s,h;vex.defaultOptions.className="vex-theme-wireframe";var c=d("#placeholder"),i=d("#stream-actions"),n=d("#gif-actions"),e=d("#action-create"),o=d(".loader"),t=e.find("img"),l={create:e,reset:d("#action-reset"),download:d("#action-download"),share:d("#action-share")},a="rgba(44,146,54,0.8)",g=new ProgressBar.Line(".progress-bar",{color:a,strokeWidth:3,duration:1,trailColor:"rgba(221,221,221,0.6)"});function f(){c.find("img").remove(),c.append(s),s.play(),g.set(0),n.hide(),i.fadeIn(),l.create.one("click",u),d(window).on("keyup",function e(t){32==t.keyCode&&(d(window).off("keyup",e),u())})}function u(){t.addClass("rotating"),g.path.setAttribute("stroke",a),d(g.svg).show(),gifshot.createGIF(h,m)}function p(e){1===e&&(g.path.setAttribute("stroke","rgba(44,146,54,0.2)"),s.pause(),t.removeClass("rotating"),o.fadeIn()),g.set(e)}function m(e){if(e.error)c.html("There was an error creating your GIF. Please refresh and try again.");else{o.hide(),d(g.svg).hide();var t=e.image,a=document.createElement("img");a.src=t,c.find("video").remove(),c.append(a),r=t,i.hide(),n.fadeIn(),l.download.attr({href:t,download:"facegif.gif"}),l.reset.one("click",f),l.share.off(),l.share.on("click",v)}}function v(){vex.open({content:'<div class="dialog-title">Share</div><div class="share-items"><a id="share-imgur" href="javascript:" title="Share on Imgur" style="overflow:hidden; width:100px; height:36px; background:url(img/imgur.png) top left no-repeat transparent;"></a></div>'}),d("#share-imgur").off().on("click",w)}function w(){var e=r.replace(/^data:[^,]+,/,"");o.fadeIn(),d.ajax({url:"https://api.imgur.com/3/image",method:"POST",headers:{Authorization:"Client-ID 1dd9c443be8f3fe",Accept:"application/json"},data:{image:e,type:"base64"}}).done(function(e){var t=d(".share-items");if(o.hide(),e.success){var a="https://imgur.com/gallery/"+e.data.id,r=document.createElement("a");r.setAttribute("href",a),r.setAttribute("title","Your faceGIF on Imgur"),r.innerHTML=a,t.append(r)}else t.append("<span>Please try again.</span>")})}GumHelper.startVideoStreaming(function(e,t,a,r,i){if(e)return void c.text("There was an error starting video, please refresh and try again.");s=a;var n=c[0].getBoundingClientRect().width,o=function(e,t,a,r){var i={width:0,height:0,scaledWidth:0,scaledHeight:0};t<e?(i.width=Math.round(e*(r/t))-a,i.scaledWidth=Math.round(i.width*(t/r))):(i.height=Math.round(t*(a/e))-r,i.scaledHeight=Math.round(i.height*(e/a)));return i}(r,i,n,n);d(s).css({width:n+o.width+"px",height:n+o.height+"px","margin-left":-Math.floor(o.width/2)+"px","margin-top":-Math.floor(o.height/2)+"px"}),h={interval:.15,numFrames:15,gifWidth:n,gifHeight:n,cameraStream:t,keepCameraOn:!0,progressCallback:p,text:"faceGIF.com",fontFamily:"Source Sans Pro",fontColor:"rgba(255,255,255,0.8)",textXCoordinate:n-50,textYCoordinate:n-5},d("#actions").show(),f()})}(jQuery);