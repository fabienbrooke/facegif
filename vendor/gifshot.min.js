!function(e,G,u,N){"use strict";function t(){}var r,i,q={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:(i=u.getUserMedia||u.webkitGetUserMedia||u.mozGetUserMedia||u.msGetUserMedia,i?i.bind(u):i),requestAnimFrame:e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame,requestTimeout:function(r,i){if(r=r||q.noop,i=i||0,!q.requestAnimFrame)return setTimeout(r,i);var n=(new Date).getTime(),o=new Object,a=q.requestAnimFrame;return o.value=a(function e(){var t=(new Date).getTime();i<=t-n?r.call():o.value=a(e)}),o},Blob:e.Blob||e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,btoa:(r=e.btoa||function(e){for(var t="",r=0,i=e.length,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=void 0,a=void 0,s=void 0,d=void 0,c=void 0,l=void 0,u=void 0;r<i;)d=(o=e.charCodeAt(r++))>>2,c=(3&o)<<4|(a=e.charCodeAt(r++))>>4,l=(15&a)<<2|(s=e.charCodeAt(r++))>>6,u=63&s,isNaN(a)?l=u=64:isNaN(s)&&(u=64),t=t+n.charAt(d)+n.charAt(c)+n.charAt(l)+n.charAt(u);return t},r?r.bind(e):q.noop),isObject:function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){return q.isObject(e)&&!Object.keys(e).length},isArray:function(e){return e&&Array.isArray(e)},isFunction:function(e){return e&&"function"==typeof e},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isSupported:{canvas:function(){var e=G.createElement("canvas");return e&&e.getContext&&e.getContext("2d")},webworkers:function(){return e.Worker},blob:function(){return q.Blob},Uint8Array:function(){return e.Uint8Array},Uint32Array:function(){return e.Uint32Array},videoCodecs:function(){var e=G.createElement("video"),t={mp4:!1,h264:!1,ogv:!1,ogg:!1,webm:!1};try{e&&e.canPlayType&&(t.mp4=""!==e.canPlayType('video/mp4; codecs="mp4v.20.8"'),t.h264=""!==(e.canPlayType('video/mp4; codecs="avc1.42E01E"')||e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),t.ogv=""!==e.canPlayType('video/ogg; codecs="theora"'),t.ogg=""!==e.canPlayType('video/ogg; codecs="theora"'),t.webm=-1!==e.canPlayType('video/webm; codecs="vp8, vorbis"'))}catch(e){}return t}()},noop:function(){},each:function(e,t){var r=void 0,i=void 0;if(q.isArray(e))for(r=-1,i=e.length;++r<i&&!1!==t(r,e[r]););else if(q.isObject(e))for(r in e)if(e.hasOwnProperty(r)&&!1===t(r,e[r]))break},mergeOptions:function(i,n){if(q.isObject(i)&&q.isObject(n)&&Object.keys){var o={};return q.each(i,function(e,t){o[e]=i[e]}),q.each(n,function(e,t){var r=n[e];q.isObject(r)&&i[e]?o[e]=q.mergeOptions(i[e],r):o[e]=r}),o}},setCSSAttr:function(r,e,t){q.isElement(r)&&(q.isString(e)&&q.isString(t)?r.style[e]=t:q.isObject(e)&&q.each(e,function(e,t){r.style[e]=t}))},removeElement:function(e){q.isElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},createWebWorker:function(e){if(!q.isString(e))return{};try{var t=new q.Blob([e],{type:"text/javascript"}),r=q.URL.createObjectURL(t);return{objectUrl:r,worker:new Worker(r)}}catch(e){return""+e}},getExtension:function(e){return e.substr(e.lastIndexOf(".")+1,e.length)},getFontSize:function(){var e=0<arguments.length&&arguments[0]!==N?arguments[0]:{};if(!G.body||!1===e.resizeFont)return e.fontSize;var t=e.text,r=e.gifWidth,i=parseInt(e.fontSize,10),n=parseInt(e.minFontSize,10),o=G.createElement("div"),a=G.createElement("span");for(o.setAttribute("width",r),o.appendChild(a),a.innerHTML=t,a.style.fontSize=i+"px",a.style.textIndent="-9999px",a.style.visibility="hidden",G.body.appendChild(a);a.offsetWidth>r&&n<=i;)a.style.fontSize=--i+"px";return G.body.removeChild(a),i+"px"},webWorkerError:!1},n=Object.freeze({default:q}),m={validate:function(i){i=q.isObject(i)?i:{};var n={};return q.each(m.validators,function(e,t){var r=t.errorCode;if(!i[r]&&!t.condition)return!((n=t).error=!0)}),delete n.condition,n},isValid:function(e){var t=!0!==m.validate(e).error;return t},validators:[{condition:q.isFunction(q.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:q.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:q.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:q.isFunction(q.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:q.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:q.isSupported.Uint8Array(),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:q.isSupported.Uint32Array(),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}],messages:{videoCodecs:{errorCode:"videocodec",errorMsg:"The video codec you are trying to use is not supported in your browser"}}},o=Object.freeze({default:m}),d={sampleInterval:10,numWorkers:2,filter:"",gifWidth:200,gifHeight:200,interval:.1,numFrames:10,frameDuration:1,keepCameraOn:!1,images:[],video:null,webcamVideoElement:null,cameraStream:null,text:"",fontWeight:"normal",fontSize:"16px",minFontSize:"10px",resizeFont:!1,fontFamily:"sans-serif",fontColor:"#ffffff",textAlign:"center",textBaseline:"bottom",textXCoordinate:null,textYCoordinate:null,progressCallback:t,completeCallback:t,saveRenderingContexts:!1,savedRenderingContexts:[],showFrameText:!0,crossOrigin:"Anonymous",waterMark:null,waterMarkHeight:null,waterMarkWidth:null,waterMarkXCoordinate:1,waterMarkYCoordinate:1},a=Object.freeze({default:d});function c(){return m.isValid()}function h(){var C,k,S,x,F,f=256,W=499,M=491,O=487,E=503,A=3*E,d=f-1,U=4,R=100,g=16,o=1<<g,h=10,p=10,v=o>>p,b=o<<h-p,T=6,I=(f>>3)*(1<<T),j=30,V=1024,H=256,m=1<<18,l=[],w=[],y=[],z=[];function L(e,t,r,i,n){var o,a,s,d,c,l,u;for((s=t-e)<-1&&(s=-1),f<(d=t+e)&&(d=f),o=t+1,a=t-1,l=1;o<d||s<a;){if(c=z[l++],o<d){u=F[o++];try{u[0]-=c*(u[0]-r)/m|0,u[1]-=c*(u[1]-i)/m|0,u[2]-=c*(u[2]-n)/m|0}catch(e){}}if(s<a){u=F[a--];try{u[0]-=c*(u[0]-r)/m|0,u[1]-=c*(u[1]-i)/m|0,u[2]-=c*(u[2]-n)/m|0}catch(e){}}}}function B(e,t,r){var i,n,o,a,s,d,c,l,u,m;for(u=l=~(1<<31),c=d=-1,i=0;i<f;i++)(n=(m=F[i])[0]-e)<0&&(n=-n),(o=m[1]-t)<0&&(o=-o),n+=o,(o=m[2]-r)<0&&(o=-o),(n+=o)<l&&(l=n,d=i),(a=n-(w[i]>>g-U))<u&&(u=a,c=i),s=y[i]>>p,y[i]-=s,w[i]+=s<<h;return y[d]+=v,w[d]-=b,c}(function(e,t,r){var i,n;for(k=e,S=t,x=r,F=new Array(f),i=0;i<f;i++)F[i]=new Array(4),(n=F[i])[0]=n[1]=n[2]=(i<<U+8)/f|0,y[i]=o/f|0,w[i]=0}).apply(this,arguments);var e={map:function(e,t,r){var i,n,o,a,s,d,c;for(s=1e3,c=-1,n=(i=l[t])-1;i<f||0<=n;)i<f&&(s<=(o=(d=F[i])[1]-t)?i=f:(i++,o<0&&(o=-o),(a=d[0]-e)<0&&(a=-a),(o+=a)<s&&((a=d[2]-r)<0&&(a=-a),(o+=a)<s&&(s=o,c=d[3])))),0<=n&&(s<=(o=t-(d=F[n])[1])?n=-1:(n--,o<0&&(o=-o),(a=d[0]-e)<0&&(a=-a),(o+=a)<s&&((a=d[2]-r)<0&&(a=-a),(o+=a)<s&&(s=o,c=d[3]))));return c}};return e.process=function(){return function(){var e,t,r,i,n,o,a,s,d,c,l,u,m,f,g,h,p,v,b,w,y;for(S<A&&(x=1),C=30+(x-1)/3,u=k,c=(l=(f=S)/(3*x))/R|(m=0),s=V,(a=(o=I)>>T)<=1&&(a=0),e=0;e<a;e++)z[e]=s*((a*a-e*e)*H/(a*a));for(d=S<A?3:S%W!=0?3*W:S%M!=0?3*M:S%O!=0?3*O:3*E,e=0;e<l;)if(g=s,h=t=B(r=(255&u[m+0])<<U,i=(255&u[m+1])<<U,n=(255&u[m+2])<<U),p=r,v=i,b=n,w=void 0,w=F[h],y=g/V,w[0]-=y*(w[0]-p)|0,w[1]-=y*(w[1]-v)|0,w[2]-=y*(w[2]-b)|0,0!==a&&L(a,t,r,i,n),f<=(m+=d)&&(m-=S),0===c&&(c=1),++e%c==0)for(s-=s/C,(a=(o-=o/j)>>T)<=1&&(a=0),t=0;t<a;t++)z[t]=s*((a*a-t*t)*H/(a*a))}(),function(){var e;for(e=0;e<f;e++)F[e][0]>>=U,F[e][1]>>=U,F[e][2]>>=U,F[e][3]=e}(),function(){var e,t,r,i,n,o,a,s;for(e=s=a=0;e<f;e++){for(i=(n=F[r=e])[1],t=e+1;t<f;t++)(o=F[t])[1]<i&&(r=t,i=o[1]);if(o=F[r],e!=r&&(t=o[0],o[0]=n[0],n[0]=t,t=o[1],o[1]=n[1],n[1]=t,t=o[2],o[2]=n[2],n[2]=t,t=o[3],o[3]=n[3],n[3]=t),i!=a){for(l[a]=s+e>>1,t=a+1;t<i;t++)l[t]=e;a=i,s=e}}for(l[a]=s+d>>1,t=a+1;t<256;t++)l[t]=d}(),function(){for(var e=[],t=new Array(f),r=0;r<f;r++)t[F[r][3]]=r;for(var i=0,n=0;n<f;n++){var o=t[n];e[i++]=F[o][0],e[i++]=F[o][1],e[i++]=F[o][2]}return e}()},e}function l(){try{this.onmessage=function(e){var t,r=e.data||{};r.gifshot&&(t=i.run(r),postMessage(t))}}catch(e){}var i={dataToRGB:function(e,t,r){for(var i=t*r*4,n=0,o=[];n<i;)o.push(e[n++]),o.push(e[n++]),o.push(e[n++]),n++;return o},componentizedPaletteToArray:function(e){e=e||[];for(var t=[],r=0;r<e.length;r+=3){var i=e[r],n=e[r+1],o=e[r+2];t.push(i<<16|n<<8|o)}return t},processFrameWithQuantizer:function(e,t,r,i){for(var n=this.dataToRGB(e,t,r),o=new h(n,n.length,i),a=o.process(),s=new Uint32Array(this.componentizedPaletteToArray(a)),d=t*r,c=new Uint8Array(d),l=0,u=0;u<d;u++){var m=n[l++],f=n[l++],g=n[l++];c[u]=o.map(m,f,g)}return{pixels:c,palette:s}},run:function(e){var t=e=e||{},r=t.height,i=(t.palette,t.sampleInterval),n=t.width,o=e.data;return this.processFrameWithQuantizer(o,n,r,i)}};return i}function g(v,e,t,r){var b=0,i=(r=r===N?{}:r).loop===N?null:r.loop,w=r.palette===N?null:r.palette;if(e<=0||t<=0||65535<e||65535<t)throw"Width/Height invalid.";v[b++]=71,v[b++]=73,v[b++]=70,v[b++]=56,v[b++]=57,v[b++]=97;if(v[b++]=255&e,v[b++]=e>>8&255,v[b++]=255&t,v[b++]=t>>8&255,v[b++]=0|(null!==w?128:0),v[b++]=0,v[b++]=0,null!==i){if(i<0||65535<i)throw"Loop count invalid.";v[b++]=33,v[b++]=255,v[b++]=11,v[b++]=78,v[b++]=69,v[b++]=84,v[b++]=83,v[b++]=67,v[b++]=65,v[b++]=80,v[b++]=69,v[b++]=50,v[b++]=46,v[b++]=48,v[b++]=3,v[b++]=1,v[b++]=255&i,v[b++]=i>>8&255,v[b++]=0}var y=!1;this.addFrame=function(e,t,r,i,n,o){if(!0===y&&(--b,y=!1),o=o===N?{}:o,e<0||t<0||65535<e||65535<t)throw"x/y invalid.";if(r<=0||i<=0||65535<r||65535<i)throw"Width/Height invalid.";if(n.length<r*i)throw"Not enough pixels for the frame size.";var a=!0,s=o.palette;if(s!==N&&null!==s||(a=!1,s=w),s===N||null===s)throw"Must supply either a local or global palette.";for(var d=function(e){var t=e.length;if(t<2||256<t||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}(s),c=0;d>>=1;)++c;d=1<<c;var l=o.delay===N?0:o.delay,u=o.disposal===N?0:o.disposal;if(u<0||3<u)throw"Disposal out of range.";var m=!1,f=0;if(o.transparent!==N&&null!==o.transparent&&(m=!0,(f=o.transparent)<0||d<=f))throw"Transparent color index.";if(0===u&&!m&&0===l||(v[b++]=33,v[b++]=249,v[b++]=4,v[b++]=u<<2|(!0===m?1:0),v[b++]=255&l,v[b++]=l>>8&255,v[b++]=f,v[b++]=0),v[b++]=44,v[b++]=255&e,v[b++]=e>>8&255,v[b++]=255&t,v[b++]=t>>8&255,v[b++]=255&r,v[b++]=r>>8&255,v[b++]=255&i,v[b++]=i>>8&255,v[b++]=!0===a?128|c-1:0,!0===a)for(var g=0,h=s.length;g<h;++g){var p=s[g];v[b++]=p>>16&255,v[b++]=p>>8&255,v[b++]=255&p}b=function(t,r,e,i){t[r++]=e;var n=r++,o=1<<e,a=o-1,s=1+o,d=1+s,c=e+1,l=0,u=0;function m(e){for(;e<=l;)t[r++]=255&u,u>>=8,l-=8,r===n+256&&(t[n]=255,n=r++)}function f(e){u|=e<<l,l+=c,m(8)}var g=i[0]&a,h={};f(o);for(var p=1,v=i.length;p<v;++p){var b=i[p]&a,w=g<<8|b,y=h[w];if(y===N){for(u|=g<<l,l+=c;8<=l;)t[r++]=255&u,u>>=8,l-=8,r===n+256&&(t[n]=255,n=r++);4096===d?(f(o),d=1+s,c=e+1,h={}):(1<<c<=d&&++c,h[w]=d++),g=b}else g=y}f(g),f(s),m(1),n+1===r?t[n]=0:(t[n]=r-n-1,t[r++]=0);return r}(v,b,c<2?2:c,n)},this.end=function(){return!1===y&&(v[b++]=59,y=!0),b}}function s(){}var X=function(e){this.canvas=null,this.ctx=null,this.repeat=0,this.frames=[],this.numRenderedFrames=0,this.onRenderCompleteCallback=s,this.onRenderProgressCallback=s,this.workers=[],this.availableWorkers=[],this.generatingGIF=!1,this.options=e,this.initializeWebWorkers(e)};X.prototype={workerMethods:l(),initializeWebWorkers:function(e){var t,r=h.toString()+"("+l.toString()+"());",i=void 0,n=void 0,o=void 0,a=-1,s="";for(t=e.numWorkers;++a<t;)i=q.createWebWorker(r),q.isObject(i)?(n=i.objectUrl,o=i.worker,this.workers.push({worker:o,objectUrl:n}),this.availableWorkers.push(o)):(s=i,q.webWorkerError=!!i);this.workerError=s,this.canvas=G.createElement("canvas"),this.canvas.width=e.gifWidth,this.canvas.height=e.gifHeight,this.ctx=this.canvas.getContext("2d"),this.frames=[]},getWorker:function(){return this.availableWorkers.pop()},freeWorker:function(e){this.availableWorkers.push(e)},byteMap:function(){for(var e=[],t=0;t<256;t++)e[t]=String.fromCharCode(t);return e}(),bufferToString:function(e){for(var t=e.length,r="",i=-1;++i<t;)r+=this.byteMap[e[i]];return r},onFrameFinished:function(e){var t=this,r=t.frames,i=!!(t.options.images||[]).length,n=r.every(function(e){return!e.beingProcessed&&e.done});t.numRenderedFrames++,i&&e(t.numRenderedFrames/r.length),t.onRenderProgressCallback(.75*t.numRenderedFrames/r.length),n?t.generatingGIF||t.generateGIF(r,t.onRenderCompleteCallback):q.requestTimeout(function(){t.processNextFrame()},1)},processFrame:function(e){function t(){var e=(0<arguments.length&&arguments[0]!==N?arguments[0]:{}).data;delete s.data,s.pixels=Array.prototype.slice.call(e.pixels),s.palette=Array.prototype.slice.call(e.palette),s.done=!0,s.beingProcessed=!1,r.freeWorker(d),r.onFrameFinished(n)}var r=this,i=(this.options,this.options),n=i.progressCallback,o=i.sampleInterval,a=this.frames,s=void 0,d=void 0;(s=a[e]).beingProcessed||s.done?this.onFrameFinished():(s.sampleInterval=o,s.beingProcessed=!0,s.gifshot=!0,(d=this.getWorker())?(d.onmessage=t,d.postMessage(s)):t({data:r.workerMethods.run(s)}))},startRendering:function(e){this.onRenderCompleteCallback=e;for(var t=0;t<this.options.numWorkers&&t<this.frames.length;t++)this.processFrame(t)},processNextFrame:function(){for(var e=-1,t=0;t<this.frames.length;t++){var r=this.frames[t];if(!r.done&&!r.beingProcessed){e=t;break}}0<=e&&this.processFrame(e)},generateGIF:function(n,e){var t=[],r={loop:this.repeat},i=this.options,o=i.interval,a=i.frameDuration,s=!!i.images.length,d=i.gifHeight,c=i.gifWidth,l=new g(t,c,d,r),u=this.onRenderProgressCallback,m=s?100*o:0,f=void 0;this.generatingGIF=!0,q.each(n,function(e,t){var r=t.palette;u(.75+.25*t.position*1/n.length);for(var i=0;i<a;i++)l.addFrame(0,0,c,d,t.pixels,{palette:r,delay:m})}),l.end(),u(1),this.frames=[],this.generatingGIF=!1,q.isFunction(e)&&(f=this.bufferToString(t),e("data:image/gif;base64,"+q.btoa(f)))},setRepeat:function(e){this.repeat=e},addFrame:function(e,t,r){t=q.isObject(t)?t:{};var i=this.ctx,n=this.options,o=n.gifWidth,a=n.gifHeight,s=q.getFontSize(t),d=t,c=d.filter,l=d.fontColor,u=d.fontFamily,m=d.fontWeight,f=(d.gifHeight,d.gifWidth,d.text),g=d.textAlign,h=d.textBaseline,p=d.waterMark,v=d.waterMarkHeight,b=d.waterMarkWidth,w=d.waterMarkXCoordinate,y=d.waterMarkYCoordinate,C=t.textXCoordinate?t.textXCoordinate:"left"===g?1:"right"===g?o:o/2,k=t.textYCoordinate?t.textYCoordinate:"top"===h?1:"center"===h?a/2:a,S=m+" "+s+" "+u,x=r&&t.showFrameText?r:f,F=void 0;try{i.filter=c,i.drawImage(e,0,0,o,a),x&&(i.font=S,i.fillStyle=l,i.textAlign=g,i.textBaseline=h,i.fillText(x,C,k)),p&&i.drawImage(p,w,y,b,v),F=i.getImageData(0,0,o,a),this.addFrameImageData(F)}catch(e){return""+e}},addFrameImageData:function(){var e=0<arguments.length&&arguments[0]!==N?arguments[0]:{},t=this.frames,r=e.data;this.frames.push({data:r,width:e.width,height:e.height,palette:null,dithering:null,done:!1,beingProcessed:!1,position:t.length})},onRenderProgress:function(e){this.onRenderProgressCallback=e},isRendering:function(){return this.generatingGIF},getBase64GIF:function(t){var r=this;r.startRendering(function(e){r.destroyWorkers(),q.requestTimeout(function(){t(e)},0)})},destroyWorkers:function(){if(!this.workerError){var e=this.workers;q.each(e,function(e,t){var r=t.worker,i=t.objectUrl;r.terminate(),q.URL.revokeObjectURL(i)})}}};function Y(){}var f={getGIF:function(){var e=0<arguments.length&&arguments[0]!==N?arguments[0]:{},i=arguments[1];i=q.isFunction(i)?i:Y;var t=G.createElement("canvas"),n=void 0,r=!!e.images.length,o=e.cameraStream,a=e.crop,s=e.filter,d=e.fontColor,c=e.fontFamily,l=e.fontWeight,u=e.keepCameraOn,m=(e.numWorkers,e.progressCallback),f=e.saveRenderingContexts,g=e.savedRenderingContexts,h=e.text,p=e.textAlign,v=e.textBaseline,b=e.videoElement,w=e.videoHeight,y=e.videoWidth,C=e.webcamVideoElement,k=e.waterMark,S=e.waterMarkHeight,x=e.waterMarkWidth,F=e.waterMarkXCoordinate,W=e.waterMarkYCoordinate,M=Number(e.gifWidth),O=Number(e.gifHeight),E=Number(e.interval),A=(Number(e.sampleInterval),r?0:1e3*E),U=[],R=g.length?g.length:e.numFrames,T=R,I=new X(e),j=q.getFontSize(e),V=e.textXCoordinate?e.textXCoordinate:"left"===p?1:"right"===p?M:M/2,H=e.textYCoordinate?e.textYCoordinate:"top"===v?1:"center"===v?O/2:O,z=l+" "+j+" "+c,L=a?Math.floor(a.scaledWidth/2):0,B=a?y-a.scaledWidth:0,P=a?Math.floor(a.scaledHeight/2):0,D=a?w-a.scaledHeight:0;R=R!==N?R:10,E=E!==N?E:.1,t.width=M,t.height=O,n=t.getContext("2d"),function e(){g.length||0!==b.currentTime?function t(){var r=T-1;function e(){var e;f&&U.push(n.getImageData(0,0,M,O)),k&&n.drawImage(k,F,W,x,S),h&&(n.font=z,n.fillStyle=d,n.textAlign=p,n.textBaseline=v,n.fillText(h,V,H)),e=n.getImageData(0,0,M,O),I.addFrameImageData(e),m((R-(T=r))/R),0<r&&q.requestTimeout(t,A),T||I.getBase64GIF(function(e){i({error:!1,errorCode:"",errorMsg:"",image:e,cameraStream:o,videoElement:b,webcamVideoElement:C,savedRenderingContexts:U,keepCameraOn:u})})}g.length?(n.putImageData(g[R-T],0,0),e()):function t(){try{y<B&&(B=y),w<D&&(D=w),L<0&&(L=0),P<0&&(P=0),n.filter=s,n.drawImage(b,L,P,B,D,0,0,M,O),e()}catch(e){if("NS_ERROR_NOT_AVAILABLE"!==e.name)throw e;q.requestTimeout(t,100)}}()}():q.requestTimeout(e,100)}()},getCropDimensions:function(){var e=0<arguments.length&&arguments[0]!==N?arguments[0]:{},t=e.videoWidth,r=e.videoHeight,i=e.gifWidth,n=e.gifHeight,o={width:0,height:0,scaledWidth:0,scaledHeight:0};return r<t?(o.width=Math.round(t*(n/r))-i,o.scaledWidth=Math.round(o.width*(r/n))):(o.height=Math.round(r*(i/t))-n,o.scaledHeight=Math.round(o.height*(t/i))),o}},p={loadedData:!1,defaultVideoDimensions:{width:640,height:480},findVideoSize:function e(t){e.attempts=e.attempts||0;var r=t.cameraStream,i=t.completedCallback,n=t.videoElement;n&&(0<n.videoWidth&&0<n.videoHeight?(n.removeEventListener("loadeddata",p.findVideoSize),i({videoElement:n,cameraStream:r,videoWidth:n.videoWidth,videoHeight:n.videoHeight})):e.attempts<10?(e.attempts+=1,q.requestTimeout(function(){p.findVideoSize(t)},400)):i({videoElement:n,cameraStream:r,videoWidth:p.defaultVideoDimensions.width,videoHeight:p.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){q.isFunction(e)&&e({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(e){var t=q.isArray(e.existingVideo)?e.existingVideo[0]:e.existingVideo,r=e.cameraStream,i=e.completedCallback,n=e.streamedCallback,o=e.videoElement;if(q.isFunction(n)&&n(),t){if(q.isString(t))o.src=t,o.innerHTML='<source src="'+t+'" type="video/'+q.getExtension(t)+'" />';else if(t instanceof Blob){try{o.src=q.URL.createObjectURL(t)}catch(e){}o.innerHTML='<source src="'+t+'" type="'+t.type+'" />'}}else if(o.mozSrcObject)o.mozSrcObject=r;else if(q.URL)try{o.srcObject=r,o.src=q.URL.createObjectURL(r)}catch(e){o.srcObject=r}o.play(),q.requestTimeout(function e(){e.count=e.count||0,!0===p.loadedData?(p.findVideoSize({videoElement:o,cameraStream:r,completedCallback:i}),p.loadedData=!1):10<(e.count+=1)?p.findVideoSize({videoElement:o,cameraStream:r,completedCallback:i}):e()},0)},startStreaming:function(e){var t=q.isFunction(e.error)?e.error:q.noop,r=q.isFunction(e.streamed)?e.streamed:q.noop,i=q.isFunction(e.completed)?e.completed:q.noop,n=e.crossOrigin,o=e.existingVideo,a=e.lastCameraStream,s=e.options,d=e.webcamVideoElement,c=q.isElement(o)?o:d||G.createElement("video");function l(e){p.stream({videoElement:c,cameraStream:e,streamedCallback:r,completedCallback:i})}n&&(c.crossOrigin=s.crossOrigin),c.autoplay=!0,c.loop=!0,c.muted=!0,c.addEventListener("loadeddata",function(e){p.loadedData=!0,s.offset&&(c.currentTime=s.offset)}),o?p.stream({videoElement:c,existingVideo:o,completedCallback:i}):a?p.stream({videoElement:c,cameraStream:a,streamedCallback:r,completedCallback:i}):u.mediaDevices&&u.mediaDevices.getUserMedia?u.mediaDevices.getUserMedia({video:!0}).then(l).catch(t):q.getUserMedia({video:!0},l,t)},startVideoStreaming:function(o){var e=1<arguments.length&&arguments[1]!==N?arguments[1]:{},t=e.timeout!==N?e.timeout:0,r=e.callback,i=e.webcamVideoElement,n=void 0;0<t&&(n=q.requestTimeout(function(){p.onStreamingTimeout(r)},1e4)),p.startStreaming({error:function(){r({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(n)},completed:function(){var e=0<arguments.length&&arguments[0]!==N?arguments[0]:{},t=e.cameraStream,r=e.videoElement,i=e.videoHeight,n=e.videoWidth;o({cameraStream:t,videoElement:r,videoHeight:i,videoWidth:n})},lastCameraStream:e.lastCameraStream,webcamVideoElement:i,crossOrigin:e.crossOrigin,options:e})},stopVideoStreaming:function(e){var t=e=q.isObject(e)?e:{},r=t.keepCameraOn,i=t.videoElement,n=t.webcamVideoElement,o=e.cameraStream||{},a=o.getTracks&&o.getTracks()||[],s=!!a.length,d=a[0];!r&&s&&q.isFunction(d.stop)&&d.stop(),q.isElement(i)&&!n&&(i.pause(),q.isFunction(q.URL.revokeObjectURL)&&!q.webWorkerError&&i.src&&q.URL.revokeObjectURL(i.src),q.removeElement(i))}};function v(e){e=q.isObject(e)?e:{},p.stopVideoStreaming(e)}function b(e,t){var r=e.options||{},i=r.images,n=r.video,o=Number(r.gifWidth),a=Number(r.gifHeight),s=(Number(r.numFrames),e.cameraStream),d=e.videoElement,c=e.videoWidth,l=e.videoHeight,u=f.getCropDimensions({videoWidth:c,videoHeight:l,gifHeight:a,gifWidth:o}),m=t;r.crop=u,r.videoElement=d,r.videoWidth=c,r.videoHeight=l,r.cameraStream=s,q.isElement(d)&&(d.width=o+u.width,d.height=a+u.height,r.webcamVideoElement||(q.setCSSAttr(d,{position:"fixed",opacity:"0"}),G.body.appendChild(d)),d.play(),f.getGIF(r,function(e){i&&i.length||n&&n.length||v(e),m(e)}))}function w(e,t){if(t=q.isFunction(e)?e:t,e=q.isObject(e)?e:{},q.isFunction(t)){var r=q.mergeOptions(d,e)||{},i=e.cameraStream,n=r.images,o=n?n.length:0,a=r.video,s=r.webcamVideoElement;r=q.mergeOptions(r,{gifWidth:Math.floor(r.gifWidth),gifHeight:Math.floor(r.gifHeight)}),o?function(){var e=0<arguments.length&&arguments[0]!==N?arguments[0]:{},n=e.callback,t=e.images,o=e.options,a=e.imagesLength,r=m.validate({getUserMedia:!0,"window.URL":!0}),s=[],d=0,c=void 0,i=void 0;if(r.error)return n(r);function l(){q.each(s,function(e,t){t&&(t.text?i.addFrame(t.img,o,t.text):i.addFrame(t,o))}),function(e,t){e.getBase64GIF(function(e){t({error:!1,errorCode:"",errorMsg:"",image:e})})}(i,n)}i=new X(o),q.each(t,function(t,r){var i,e=r;r.src&&(e=e.src),q.isElement(e)?(o.crossOrigin&&(e.crossOrigin=o.crossOrigin),s[t]=e,(d+=1)===a&&l()):q.isString(e)&&(c=new Image,o.crossOrigin&&(c.crossOrigin=o.crossOrigin),i=c,r.text&&(i.text=r.text),i.onerror=function(e){if(0==--a)return n({error:"None of the requested images was capable of being retrieved"})},i.onload=function(e){r.text?s[t]={img:i,text:i.text}:s[t]=i,(d+=1)===a&&l(),q.removeElement(i)},i.src=e,q.setCSSAttr(c,{position:"fixed",opacity:"0"}),G.body.appendChild(c))})}({images:n,imagesLength:o,callback:t,options:r}):a?function(){var e=0<arguments.length&&arguments[0]!==N?arguments[0]:{},t=e.callback,r=e.existingVideo,i=e.options,n=m.validate({getUserMedia:!0,"window.URL":!0}),o=void 0,a=void 0;if(n.error)return t(n);if(q.isElement(r)&&r.src){if(a=r.src,o=q.getExtension(a),!q.isSupported.videoCodecs[o])return t(m.messages.videoCodecs)}else q.isArray(r)&&q.each(r,function(e,t){if(o=t instanceof Blob?t.type.substr(t.type.lastIndexOf("/")+1,t.length):t.substr(t.lastIndexOf(".")+1,t.length),q.isSupported.videoCodecs[o])return r=t,!1});p.startStreaming({completed:function(e){e.options=i||{},b(e,t)},existingVideo:r,crossOrigin:i.crossOrigin,options:i})}({existingVideo:a,callback:t,options:r}):function(){var e=0<arguments.length&&arguments[0]!==N?arguments[0]:{},t=e.callback,r=e.lastCameraStream,i=e.options,n=e.webcamVideoElement;if(!c())return t(m.validate());i.savedRenderingContexts.length?f.getGIF(i,function(e){t(e)}):p.startVideoStreaming(function(){var e=0<arguments.length&&arguments[0]!==N?arguments[0]:{};e.options=i||{},b(e,t)},{lastCameraStream:r,callback:t,webcamVideoElement:n,crossOrigin:i.crossOrigin})}({lastCameraStream:i,callback:t,webcamVideoElement:s,options:r})}}var y={utils:n,error:o,defaultOptions:a,createGIF:w,takeSnapShot:function(e,t){if(t=q.isFunction(e)?e:t,e=q.isObject(e)?e:{},q.isFunction(t)){var r=q.mergeOptions(d,e);w(q.mergeOptions(r,{interval:.1,numFrames:1,gifWidth:Math.floor(r.gifWidth),gifHeight:Math.floor(r.gifHeight)}),t)}},stopVideoStreaming:v,isSupported:function(){return m.isValid()},isWebCamGIFSupported:c,isExistingVideoGIFSupported:function(e){var r=!1;if(q.isArray(e)&&e.length){if(q.each(e,function(e,t){q.isSupported.videoCodecs[t]&&(r=!0)}),!r)return!1}else if(q.isString(e)&&e.length&&!q.isSupported.videoCodecs[e])return!1;return m.isValid({getUserMedia:!0})},isExistingImagesGIFSupported:function(){return m.isValid({getUserMedia:!0})},VERSION:"0.4.5"};"function"==typeof define&&define.amd?define([],function(){return y}):"undefined"!=typeof exports?module.exports=y:e.gifshot=y}("undefined"!=typeof window?window:{},"undefined"!=typeof document?document:{createElement:function(){}},"undefined"!=typeof window?window.navigator:{});